version: '3.0'
services:

  mysql:
    image: brightspot/mysql:mysql5.6
    volumes:
      - mysql-data:/var/lib/mysql
      - mysql-logs:/var/log/mysql
  solr:
    image: brightspot/solr:8
    environment:
      -  SOLR_CONFIG=dari-solr-11
    ports:
      - 8081:8080
    volumes:
      - solr-data:/var/solr/data/collection1/data

  tomcat:
    image: brightspot/tomcat:9-jdk11
    ports:
      - 5005:5005
    volumes:
      - storage:/servers/tomcat/storage
      - .:${PROJECT_DIRECTORY}:cached
      # Override the following line in a git ignored docker-compose.override.yml with your local Brightspot directory.
      #- <LOCAL BSP DIR>:${BRIGHTSPOT_DIRECTORY}:cached
    environment:
      - BRIGHTSPOT_PROJECT_DIRECTORY=/code
      - CONTEXT_PROPERTIES=${PROJECT_DIRECTORY}/docker-context.properties
      - MYSQL_DATABASE=brightspot
      - ROOT_WAR=${PROJECT_DIRECTORY}/build/libs/brightspot-tutorial-1.0.0-SNAPSHOT.war
      - SOLR_URL=http://solr:8080/solr/collection1
    depends_on:
      - apache
      - mysql
      - solr

  apache:
    image: brightspot/apache:2-dims3
    ports:
      - 80:80
      - 443:443
    volumes:
      - storage:/var/www/localhost/htdocs/storage

  greenmail:
    image: greenmail/standalone:2.1.0-alpha-4
    ports:
      # Debug
      - 3080:8080
      # Outgoing
      - 3025:3025 # SMTP
      - 3465:3465 # SMTP(s)
      # Incoming
      - 3143:3143 # IMAP
      - 3110:3110 # POP3
      - 3993:3993 # IMAP(s)
      - 3995:3995 # POP3(s)
    environment:
      - GREENMAIL_OPTS=-Dgreenmail.setup.test.all -Dgreenmail.hostname=greenmail -Dgreenmail.auth.disabled -Dgreenmail.timeout=10000 -Dgreenmail.startup.timeout=10000

volumes:
  mysql-data:
  mysql-logs:
  solr-data:
  storage:
